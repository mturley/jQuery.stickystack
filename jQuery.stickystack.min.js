
(function($){var stacks=[];$.fn.stickystack=function(mode){var container,stack;if(mode===undefined)mode='top';if(mode!=='top'&&mode!=='always'){warn("jQuery.stickystack: invalid mode: ",mode);return null;}
if(this.hasClass('stickystack-item')){warn("jQuery.stickystack: that stack is already sticky!");return null;}
container=this.stickystackFindContainer();stack={'mode':mode,'elements':this,'container':container};stacks.push(stack);this.addClass('stickystack-item').addClass('stickystack-mode-'+mode).each(function(index){var t=$(this);var placeholder=$("<div />").addClass('stickystack-placeholder').css({'width':t.outerWidth(),'height':'0'}).insertBefore(t);placeholder.data({'fullHeight':t.outerHeight(),'placeholderFor':t});t.data({'stickystackOriginalStyle':{'position':t.css('position'),'top':t.css('top'),'left':t.css('left'),'width':t.css('width'),'z-index':t.css('z-index'),'visibility':t.css('visibility')},'stickystackContainer':container,'stickystackPrevItem':(index!==0?$(stack.elements[index-1]):$([])),'stickystackNextItem':(index!==stack.elements.length-1?$(stack.elements[index+1]):$([])),'stickystackPlaceholder':placeholder,'stickystackMode':mode});});if(!container.data('stickystackInitialized')){container.stickystackScrollable().on('scroll.stickystack',function(){container.stickystackUpdate();});container.data({'stickystackInitialized':true,'stickystackObj':stack});container.stickystackUpdate();}};$.fn.stickystackResetStyle=function(){if(this.length!==0){var orig=$(this).data('stickystackOriginalStyle');for(var prop in orig){$(this).css(prop,orig[prop]);}
var placeholder=$(this).data('stickystackPlaceholder');placeholder.css('height','0');$(this).removeClass('stickystack-fixed stickystack-absolute');}};$.fn.stickystackUpdate=function(){var container=this;if(this.is('body'))container=$(document);if(!container.data('stickystackInitialized')){warn("jQuery.stickystack: that's not an initialized stickystack container:",container);if(this.first().data('stickystackContainer')){log("jQuery.stickystack: updated anyway based on the associated container.");this.first().data('stickystackContainer').stickystackUpdate();}
return null;}
var topBuffer=0;var leftPos=container.data('stickystackObj').elements.first().data('stickystackPlaceholder').offset().left;container.find('.stickystack-item').each(function(){var t=$(this);var mode=t.data('stickystackMode');var placeholder=t.data('stickystackPlaceholder');var width=t.width();var scrollTop=t.data('stickystackContainer').scrollTop();var prev=t.data('stickystackPrevItem');var outOfViewAbove=placeholder.offset().top<=scrollTop+topBuffer;var colliding=false;if(prev.length!==0)colliding=placeholder.offset().top<=prev.offset().top+prev.outerHeight();if(colliding){prev.removeClass('stickystack-fixed').addClass('stickystack-absolute').css({'position':'absolute','top':(t.offset().top-prev.outerHeight())+'px','left':leftPos+'px','width':width+'px','z-index':0,'visibility':'visible'});if(prev.offset().left!=leftPos)prev.css('left','0px');var prevplaceholder=prev.data('stickystackPlaceholder');prevplaceholder.css('height',prevplaceholder.data('fullHeight')+'px');}
if(!outOfViewAbove){t.stickystackResetStyle();}else{t.removeClass('stickystack-absolute').addClass('stickystack-fixed').css({'position':'fixed','top':topBuffer+'px','left':leftPos+'px','width':width+'px','z-index':100,'visibility':'visible'});placeholder.css({'height':placeholder.data('fullHeight')+'px'});if(mode==='always')topBuffer+=$(this).outerHeight();}});if(container.find('.stickystack-fixed.stickystack-mode-top').length!==0){container.find('.stickystack-absolute').css('visibility','hidden');}};$.fn.stickystackUnstick=function(){var classes='stickystack-item stickystack-mode-top stickystack-mode-always stickystack-fixed stickystack-absolute';var container=this.first().data('stickystackContainer');container.find('stickystack-placeholder').remove();container.find('stickystack-item').each(function(){$(this).removeClass(classes);$(this).stickystackResetStyle();$(this).removeData(['stickystackOriginalStyle','stickystackContainer']);});if(container.data('stickystackInitialized')){container.stickystackScrollable().off('scroll.stickystack');container.data('stickystackObj').detached=true;stacks=stacks.filter(function(stack){return!stack.detached;});container.removeData(['stickystackObj','stickystackInitialized']);}};$.fn.stickystackFindContainer=function(){var t=this.stickystackCommonAncestor();while(!t.is('body')){var o=t.css('overflow');if(o==='auto'||o==='scroll'&&t.get(0).scrollHeight>t.height()){return t;}
t=t.parent();}
return $(document);};$.fn.stickystackCommonAncestor=function(){if(this.length===0)return this;var parents=[];var minlen=Infinity;this.each(function(){var curparents=$(this).parents();parents.push(curparents);minlen=Math.min(minlen,curparents.length);});for(var i in parents){parents[i]=parents[i].slice(parents[i].length-minlen);}
for(var i=0;i<parents[0].length;i++){var equal=true;for(var j in parents){if(parents[j][i]!==parents[0][i]){equal=false;break;}}
if(equal)return $(parents[0][i]);}
return $([]);};$.fn.stickystackScrollable=function(){if(this.is("body"))return $(document);return this;};$(document).ready(function(){$(window).resize(function(){$.each(stacks,function(idx,stack){stack.container.stickystackUpdate();});})});function log(){if(console.log)console.log.apply(console,arguments);}
function warn(){if(console.warn)console.warn.apply(console,arguments);}})(jQuery);